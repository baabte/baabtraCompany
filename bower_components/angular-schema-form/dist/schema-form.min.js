var deps=["ObjectPath"];try{angular.module("ngSanitize"),deps.push("ngSanitize")}catch(e){}try{angular.module("ui.sortable"),deps.push("ui.sortable")}catch(e){}try{angular.module("angularSpectrumColorpicker"),deps.push("angularSpectrumColorpicker")}catch(e){}angular.module("schemaForm",deps),angular.module("schemaForm").provider("sfPath",["ObjectPathProvider",function(e){var r={parse:e.parse};r.stringify=1===angular.version.major&&angular.version.minor<3?function(e){return Array.isArray(e)?e.join("."):e.toString()}:e.stringify,r.normalize=function(e,t){return r.stringify(Array.isArray(e)?e:r.parse(e),t)},this.parse=r.parse,this.stringify=r.stringify,this.normalize=r.normalize,this.$get=function(){return r}}]),angular.module("schemaForm").factory("sfSelect",["sfPath",function(e){var r=/^\d+$/;return function(t,a,n){a||(a=this);var i="string"==typeof t?e.parse(t):t;if("undefined"!=typeof n&&1===i.length)return a[i[0]]=n,a;"undefined"!=typeof n&&"undefined"==typeof a[i[0]]&&(a[i[0]]=i.length>2&&r.test(i[1])?[]:{});for(var o=a[i[0]],u=1;u<i.length;u++){if(""===i[u])return void 0;if("undefined"!=typeof n){if(u===i.length-1)return o[i[u]]=n,n;var l=o[i[u]];("undefined"==typeof l||null===l)&&(l=r.test(i[u+1])?[]:{},o[i[u]]=l),o=l}else o&&(o=o[i[u]])}return o}}]),angular.module("schemaForm").provider("schemaFormDecorators",["$compileProvider","sfPathProvider",function(e,r){var t="",a={},n=function(e,r){"sfDecorator"===e&&(e=t);for(var n=a[e],i=n.rules,o=0;o<i.length;o++){var u=i[o](r);if(u)return u}return n.mappings[r.type]?n.mappings[r.type]:n.mappings["default"]},i=function(t){e.directive(t,["$parse","$compile","$http","$templateCache",function(e,a,i,o){return{restrict:"AE",replace:!1,transclude:!1,scope:!0,require:"?^sfSchema",link:function(e,u,l,s){var c=e.$watch(l.form,function(l){if(l){e.form=l;var s=n(t,l);i.get(s,{cache:o}).then(function(t){var n=l.key?r.stringify(l.key).replace(/"/g,"&quot;"):"",i=t.data.replace(/\$\$value\$\$/g,"model"+("["!==n[0]?".":"")+n);u.html(i),a(u.contents())(e)}),c()}});e.showTitle=function(){return e.form&&e.form.notitle!==!0&&e.form.title},e.listToCheckboxValues=function(e){var r={};return angular.forEach(e,function(e){r[e]=!0}),r},e.checkboxValuesToList=function(e){var r=[];return angular.forEach(e,function(e,t){e&&r.push(t)}),r},e.buttonClick=function(r,t){angular.isFunction(t.onClick)?t.onClick(r,t):angular.isString(t.onClick)&&(s?s.evalInParentScope(t.onClick,{$event:r,form:t}):e.$eval(t.onClick,{$event:r,form:t}))},e.evalExpr=function(r,t){return s?s.evalInParentScope(r,t):e.$eval(r,t)},e.evalInScope=function(r,t){return r?e.$eval(r,t):void 0},e.errorMessage=function(r){return e.form.validationMessage?r?angular.isString(e.form.validationMessage)?e.form.validationMessage:e.form.validationMessage[r.code]||e.form.validationMessage["default"]:e.form.validationMessage.number||e.form.validationMessage["default"]||e.form.validationMessage:r?r.message:"Not a number"}}}}])},o=function(r,t,a){a=angular.isDefined(a)?a:!1,e.directive("sf"+angular.uppercase(r[0])+r.substr(1),function(){return{restrict:"EAC",scope:!0,replace:!0,transclude:a,template:'<sf-decorator form="form"></sf-decorator>',link:function(e,t,a){var n={items:"c",titleMap:"c",schema:"c"},i={type:r},o=!0;angular.forEach(a,function(r,t){if("$"!==t[0]&&0!==t.indexOf("ng")&&"sfField"!==t){var u=function(r){angular.isDefined(r)&&r!==i[t]&&(i[t]=r,o&&i.type&&(i.key||angular.isUndefined(a.key))&&(e.form=i,o=!1))};"model"===t?e.$watch(r,function(r){r&&e.model!==r&&(e.model=r)}):"c"===n[t]?e.$watchCollection(r,u):a.$observe(t,u)}})}}})};this.createDecorator=function(e,r,n){a[e]={mappings:r||{},rules:n||[]},a[t]||(t=e),i(e)},this.createDirective=o,this.createDirectives=function(e){angular.forEach(e,function(e,r){o(r,e)})},this.directive=function(e){return e=e||t,a[e]},this.addMapping=function(e,r,t){a[e]&&(a[e].mappings[r]=t)},this.$get=function(){return{directive:function(e){return a[e]},defaultDecorator:t}},i("sfDecorator")}]),angular.module("schemaForm").provider("schemaForm",["sfPathProvider",function(e){var r=function(e){var r=[];return e.forEach(function(e){r.push({name:e,value:e})}),r},t=function(e,r){if(!angular.isArray(e)){var t=[];return r?angular.forEach(r,function(r){t.push({name:e[r],value:r})}):angular.forEach(e,function(e,r){t.push({name:e,value:r})}),t}return e},a=function(e,r,t){var a=d[r.type];if(a)for(var n,i=0;i<a.length;i++)if(n=a[i](e,r,t))return n},n=function(e,r,a){a=a||{};var n=a.global&&a.global.formDefaults?angular.copy(a.global.formDefaults):{};return n.title=a.global&&a.global.supressPropertyTitles===!0?r.title:r.title||e,r.description&&(n.description=r.description),(a.required===!0||r.required===!0)&&(n.required=!0),r.maxLength&&(n.maxlength=r.maxLength),r.minLength&&(n.minlength=r.maxLength),(r.readOnly||r.readonly)&&(n.readonly=!0),r.minimum&&(n.minimum=r.minimum+(r.exclusiveMinimum?1:0)),r.maximum&&(n.maximum=r.maximum-(r.exclusiveMaximum?1:0)),r.validationMessage&&(n.validationMessage=r.validationMessage),r.enumNames&&(n.titleMap=t(r.enumNames,r["enum"])),n.schema=r,n.ngModelOptions=n.ngModelOptions||{},n},i=function(r,t,a){if("string"===t.type&&!t["enum"]){var i=n(r,t,a);return i.key=a.path,i.type="text",a.lookup[e.stringify(a.path)]=i,i}},o=function(r,t,a){if("number"===t.type){var i=n(r,t,a);return i.key=a.path,i.type="number",a.lookup[e.stringify(a.path)]=i,i}},u=function(r,t,a){if("integer"===t.type){var i=n(r,t,a);return i.key=a.path,i.type="number",a.lookup[e.stringify(a.path)]=i,i}},l=function(r,t,a){if("boolean"===t.type){var i=n(r,t,a);return i.key=a.path,i.type="checkbox",a.lookup[e.stringify(a.path)]=i,i}},s=function(t,a,i){if("string"===a.type&&a["enum"]){var o=n(t,a,i);return o.key=i.path,o.type="select",o.titleMap||(o.titleMap=r(a["enum"])),i.lookup[e.stringify(i.path)]=o,o}},c=function(t,a,i){if("array"===a.type&&a.items&&a.items["enum"]){var o=n(t,a,i);return o.key=i.path,o.type="checkboxes",o.titleMap||(o.titleMap=r(a.items["enum"])),i.lookup[e.stringify(i.path)]=o,o}},f=function(r,t,i){if("object"===t.type){var o=n(r,t,i);return o.type="fieldset",o.items=[],i.lookup[e.stringify(i.path)]=o,angular.forEach(t.properties,function(r,n){var u=i.path.slice();if(u.push(n),i.ignore[e.stringify(u)]!==!0){var l=t.required&&-1!==t.required.indexOf(n),s=a(n,r,{path:u,required:l||!1,lookup:i.lookup,ignore:i.ignore});s&&o.items.push(s)}}),o}},m=function(r,t,i){if("array"===t.type){var o=n(r,t,i);o.type="array",o.key=i.path,i.lookup[e.stringify(i.path)]=o;var u=t.required&&-1!==t.required.indexOf(i.path[i.path.length-1]),l=i.path.slice();return l.push(""),o.items=[a(r,t.items,{path:l,required:u||!1,lookup:i.lookup,ignore:i.ignore,global:i.global})],o}},d={string:[s,i],object:[f],number:[o],integer:[u],"boolean":[l],array:[c,m]},p=function(e){return e};this.defaults=d,this.stdFormObj=n,this.defaultFormDefinition=a,this.postProcess=function(e){p=e},this.appendRule=function(e,r){d[e]||(d[e]=[]),d[e].push(r)},this.prependRule=function(e,r){d[e]||(d[e]=[]),d[e].unshift(r)},this.createStandardForm=n,this.$get=function(){var r={};return r.merge=function(a,n,i,o,u){n=n||["*"],o=o||{},u=u||a.readonly||a.readOnly;var l=r.defaults(a,i,o),s=n.indexOf("*");-1!==s&&(n=n.slice(0,s).concat(l.form).concat(n.slice(s+1)));var c=l.lookup;return p(n.map(function(n){if("string"==typeof n&&(n={key:n}),n.key&&"string"==typeof n.key&&(n.key=e.parse(n.key)),n.titleMap&&(n.titleMap=t(n.titleMap)),n.itemForm){n.items=[];var l=e.stringify(n.key),s=c[l];angular.forEach(s.items,function(e){var r=angular.copy(n.itemForm);r.key=e.key,n.items.push(r)})}if(n.key){var f=e.stringify(n.key);c[f]&&(n=angular.extend(c[f],n))}return u===!0&&(n.readonly=!0),n.items&&(n.items=r.merge(a,n.items,i,o,n.readonly)),n.tabs&&angular.forEach(n.tabs,function(e){e.items=r.merge(a,e.items,i,o,n.readonly)}),"checkbox"===n.type&&angular.isUndefined(n.schema["default"])&&(n.schema["default"]=!1),n}))},r.defaults=function(e,r,t){var n=[],i={};if(r=r||{},t=t||{},"object"!==e.type)throw new Error('Not implemented. Only type "object" allowed at root level of schema.');return angular.forEach(e.properties,function(o,u){if(r[u]!==!0){var l=e.required&&-1!==e.required.indexOf(u),s=a(u,o,{path:[u],lookup:i,ignore:r,required:l,global:t});s&&n.push(s)}}),{form:n,lookup:i}},r.traverseSchema=function(e,r,t,a){a=angular.isDefined(a)?a:!0,t=t||[];var n=function(e,r,t){if(r(e,t),angular.forEach(e.properties,function(e,a){var i=t.slice();i.push(a),n(e,r,i)}),!a&&e.items){var i=t.slice();i.push(""),n(e.items,r,i)}};n(e,r,t||[])},r.traverseForm=function(e,t){t(e),angular.forEach(e.items,function(e){r.traverseForm(e,t)}),e.tabs&&angular.forEach(e.tabs,function(e){angular.forEach(e.items,function(e){r.traverseForm(e,t)})})},r}}]),angular.module("schemaForm").factory("sfValidator",[function(){var e={};return e.validate=function(e,r){if(!e)return{valid:!0};var t=e.schema;if(!t)return{valid:!0};""===r&&(r=void 0),"number"===e.type&&null===r&&(r=void 0);var a={type:"object",properties:{}},n=e.key[e.key.length-1];a.properties[n]=t,e.required&&(a.required=[n]);var i={};return angular.isDefined(r)&&(i[n]=r),tv4.validateResult(i,a)},e}]),angular.module("schemaForm").directive("sfArray",["sfSelect","schemaForm","sfValidator",function(e,r,t){var a=function(e){return function(r){r.key&&(r.key[r.key.indexOf("")]=e)}};return{restrict:"A",scope:!0,require:"?ngModel",link:function(n,i,o,u){var l={},s=n.$watch(o.sfArray,function(i){var o=e(i.key,n.model);if(angular.isUndefined(o)&&(o=[],e(i.key,n.model,o)),n.modelArray=o,i.items){var c=i.items[0];i.items.length>1&&(c={type:"section",items:i.items.map(function(e){return e.ngModelOptions=i.ngModelOptions,e.readonly=i.readonly,e})})}if(n.copyWithIndex=function(e){if(!l[e]&&c){var t=angular.copy(c);t.arrayIndex=e,r.traverseForm(t,a(e)),l[e]=t}return l[e]},n.appendToArray=function(){var t=o.length,a=n.copyWithIndex(t);if(r.traverseForm(a,function(r){r.key&&angular.isDefined(r["default"])&&e(r.key,n.model,r["default"])}),t===o.length){var u,l=e("schema.items.type",i);"object"===l?u={}:"array"===l&&(u=[]),o.push(u)}return n.validateArray&&n.validateArray(),o},n.deleteFromArray=function(e){return o.splice(e,1),n.validateArray&&n.validateArray(),o},i.titleMap||i.startEmpty===!0||0!==o.length||n.appendToArray(),i.titleMap&&i.titleMap.length>0){n.titleMapValues=[];var f=function(e){n.titleMapValues=[],e=e||[],i.titleMap.forEach(function(r){n.titleMapValues.push(-1!==e.indexOf(r.value))})};f(n.modelArray),n.$watchCollection("modelArray",f),n.$watchCollection("titleMapValues",function(e){if(e){for(var r=n.modelArray;r.length>0;)r.shift();i.titleMap.forEach(function(t,a){e[a]&&r.push(t.value)})}})}if(u){var m;n.validateArray=function(){var e=t.validate(i,n.modelArray.length>0?n.modelArray:void 0);e.valid!==!1||!e.error||""!==e.error.dataPath&&e.error.dataPath!=="/"+i.key[i.key.length-1]?u.$setValidity("schema",!0):(u.$setViewValue(n.modelArray),m=e.error,u.$setValidity("schema",!1))},n.$on("schemaFormValidate",n.validateArray),n.hasSuccess=function(){return u.$valid&&!u.$pristine},n.hasError=function(){return u.$invalid},n.schemaError=function(){return m}}s()})}}}]),angular.module("schemaForm").directive("sfChanged",function(){return{require:"ngModel",restrict:"AC",scope:!1,link:function(e,r,t,a){var n=e.$eval(t.sfChanged);n&&n.onChange&&a.$viewChangeListeners.push(function(){angular.isFunction(n.onChange)?n.onChange(a.$modelValue,n):e.evalExpr(n.onChange,{modelValue:a.$modelValue,form:n})})}}}),angular.module("schemaForm").directive("sfSchema",["$compile","schemaForm","schemaFormDecorators","sfSelect",function(e,r,t,a){var n=/[A-Z]/g,i=function(e,r){return r=r||"_",e.replace(n,function(e,t){return(t?r:"")+e.toLowerCase()})};return{scope:{schema:"=sfSchema",initialForm:"=sfForm",model:"=sfModel",options:"=sfOptions"},controller:["$scope",function(e){this.evalInParentScope=function(r,t){return e.$parent.$eval(r,t)}}],replace:!1,restrict:"A",transclude:!0,require:"?form",link:function(n,o,u,l,s){n.formCtrl=l;var c={};s(n,function(e){if(e.addClass("schema-form-ignore"),o.prepend(e),o[0].querySelectorAll){var r=o[0].querySelectorAll("[ng-model]");if(r)for(var t=0;t<r.length;t++){var a=r[t].getAttribute("ng-model");c[a.substring(a.indexOf(".")+1)]=!0}}});var f={};n.$watch(function(){var l=n.schema,s=n.initialForm||["*"];if(s&&l&&l.type&&(f.form!==s||f.schema!==l)&&Object.keys(l.properties).length>0){f.schema=l,f.form=s;var m=r.merge(l,s,c,n.options),d=document.createDocumentFragment();n.schemaForm={form:m,schema:l},o.children(":not(.schema-form-ignore)").remove(),angular.forEach(m,function(e,r){var a=document.createElement(u.sfDecorator||i(t.defaultDecorator,"-"));a.setAttribute("form","schemaForm.form["+r+"]");var n;try{n=o[0].querySelector('*[sf-insert-field="'+e.key+'"]')}catch(l){n=null}n?(n.innerHTML="",n.appendChild(a)):d.appendChild(a)}),o[0].appendChild(d),e(o.children())(n),r.traverseSchema(l,function(e,r){if(angular.isDefined(e["default"])){var t=a(r,n.model);angular.isUndefined(t)&&a(r,n.model,e["default"])}})}})}}}]),angular.module("schemaForm").directive("schemaValidate",["sfValidator",function(e){return{restrict:"A",scope:!1,priority:1e3,require:"ngModel",link:function(r,t,a,n){r.ngModel=n;var i=null,o=function(){return u||(u=r.$eval(a.schemaValidate)),u},u=o();n.$validators?n.$validators.schema=function(r){var t=e.validate(o(),r);return i=t.error,t.valid}:n.$parsers.push(function(r){if(u=o(),!u)return r;var t=e.validate(u,r);return t.valid?(n.$setValidity("schema",!0),r):(n.$setValidity("schema",!1),void(i=t.error))}),r.$on("schemaFormValidate",function(){n.$validate?(n.$validate(),n.$invalid&&(n.$dirty=!0,n.$pristine=!1)):n.$setViewValue(n.$viewValue)}),r.hasSuccess=function(){return n.$valid&&(!n.$pristine||!n.$isEmpty(n.$modelValue))},r.hasError=function(){return n.$invalid&&!n.$pristine},r.schemaError=function(){return i}}}}]);